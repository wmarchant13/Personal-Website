# .husky/commit-msg

# âœ… Enforce:
# - type(scope): description
# - type = lowercase word
# - scope = one or more lowercase/hyphen words, separated by comma (no trailing commas, no empty scopes)
# - colon has no space before, one space after
# - description starts lowercase, doesn't end with a dot
REGEX="^(feat|fix|chore|docs|style|refactor|perf|test|build|ci)\([a-zA-Z0-9_-]+\): .+$"

# Get the current commit message
current_commit_msg=$(cat "$1")

# Get the previous commit message
previous_commit_msg=$(git log -1 --pretty=%B)

# Check if the current commit message is the same as the previous one
if [ "$current_commit_msg" = "$previous_commit_msg" ]; then
  echo "âŒ Commit message is the same as the previous one."
  echo "ğŸ’¡ Please change the commit message before committing."
  exit 1
fi

# Check commit message format using the regex
if ! grep -qE "$REGEX" "$1"; then
  echo "âŒ Invalid commit message format."
  echo "ğŸ’¡ Expected: type(scope): description"
  exit 1
fi

# Run commitlint
bun --no-install commitlint --edit "$1"